<!-- Toast -->
<div class="pc-toast" *ngIf="toastVisible" [class.bad]="toastType==='bad'">
  {{ toastMsg }}
</div>

<div class="perfil-wrap">
  <div class="perfil-head">
    <div>
      <h1>Perfil</h1>
      <p>Edita tus datos y tu foto de perfil</p>
    </div>
  </div>

  <div class="perfil-grid">
    <!-- Foto -->
    <section class="pc-card">
      <div class="pc-card-h">
        <h2>Foto de perfil</h2>
        <p>Pega una URL de imagen (Drive, Imgur, etc.).</p>
      </div>

      <div class="photo-box">
        <ng-container *ngIf="(user.fotoPerfil || photoUrl); else noPhoto">
          <img
            [src]="(photoUrl || user.fotoPerfil)!"
            alt="Foto de perfil"
            (error)="toast('La URL no parece ser una imagen vÃ¡lida.', 'bad')"
          />
        </ng-container>

        <ng-template #noPhoto>
          <div class="photo-empty">
            <div class="ph-ic">ðŸ–¼</div>
            <div class="ph-t">Sin foto</div>
          </div>
        </ng-template>
      </div>

      <label class="lbl">URL</label>
      <input class="inp" [(ngModel)]="photoUrl" placeholder="https://..." />

      <button class="btn primary" (click)="guardarFoto()" [disabled]="savingPhoto || loading">
        <span *ngIf="!savingPhoto">Guardar foto</span>
        <span *ngIf="savingPhoto">Guardando...</span>
      </button>
    </section>

    <!-- Datos -->
    <section class="pc-card wide">
      <div class="pc-card-h">
        <h2>Datos del perfil</h2>
        <p>Estos datos se muestran en la plataforma.</p>
      </div>

      <div class="form-grid">
        <div>
          <label class="lbl">Nombre</label>
          <input class="inp" [(ngModel)]="user.nombre" placeholder="Tu nombre" />
        </div>

        <div>
          <label class="lbl">Correo</label>
          <input class="inp" [(ngModel)]="user.email" placeholder="correo@algo.com" />
        </div>

        <div>
          <label class="lbl">TelÃ©fono (opcional)</label>
          <input class="inp" [(ngModel)]="user.telefonoCelular" placeholder="55..." />
        </div>

        <div>
          <label class="lbl">CURP (opcional)</label>
          <input class="inp" [(ngModel)]="user.curp" placeholder="..." />
        </div>
      </div>

      <div class="actions">
        <button class="btn ghost" (click)="loadUser()" [disabled]="loading || savingProfile">
          Recargar
        </button>

        <button class="btn primary" (click)="guardarCambios()" [disabled]="savingProfile || loading">
          <span *ngIf="!savingProfile">Guardar cambios</span>
          <span *ngIf="savingProfile">Guardando...</span>
        </button>
      </div>
    </section>

    <!-- âœ… Resumen como antes + datos -->
    <section class="pc-card wide">
      <div class="pc-card-h">
        <h2>Resumen</h2>
        <p>Tu actividad en la plataforma</p>
      </div>

      <!-- Recuadros como estaba -->
      <div class="stats-grid">
        <div class="statbox">
          <div class="st-title">Mascotas</div>
          <div class="st-value">{{ getStat(stats.mascotas) }}</div>
        </div>

        <div class="statbox">
          <div class="st-title">Posts</div>
          <div class="st-value">{{ getStat(stats.posts) }}</div>
        </div>

        <div class="statbox">
          <div class="st-title">Adopciones</div>
          <div class="st-value">{{ getStat(stats.adopciones) }}</div>
        </div>

        <div class="statbox">
          <div class="st-title">Solicitudes</div>
          <div class="st-value">{{ getStat(stats.solicitudes) }}</div>
        </div>
      </div>

      <!-- Datos (los de la foto) -->
      <div class="summary-divider"></div>

      <div class="summary-title">Datos rÃ¡pidos</div>

      <div class="summary-table">
        <div class="srow" *ngFor="let r of summaryRows">
          <div class="sk">{{ r.label }}</div>
          <div class="sv" [class.ok]="r.tone==='ok'" [class.warn]="r.tone==='warn'">
            {{ r.value }}
          </div>
        </div>
      </div>

      <div class="summary-hint">
        Si algo se ve desactualizado, presiona <b>Recargar</b>.
      </div>
    </section>
  </div>

  <div class="loading" *ngIf="loading">
    <div class="spinner"></div>
    <div>Cargando perfil...</div>
  </div>
</div>

<!-- Modal -->
<div class="pc-backdrop" *ngIf="modal !== 'none'" (click)="closeModal()"></div>

<div class="pc-modal-wrap" *ngIf="modal !== 'none'" (click)="closeModal()">
  <div class="pc-modal" (click)="$event.stopPropagation()">
    <div class="pc-modal-h">
      <div class="pc-title">{{ modalTitle }}</div>
      <button class="xbtn" (click)="closeModal()">âœ•</button>
    </div>

    <div class="pc-modal-b">
      <p>{{ modalText }}</p>
    </div>

    <div class="pc-modal-a">
      <button class="btn primary" (click)="closeModal()">OK</button>
    </div>
  </div>
</div>
